[                    ] 
 登录社区

[dfb80b22c483]

  • 博客
  • 聚能聊
  • 直播
  • 订阅
  • 科技头条NEW
  • 更多

        问答
        视频
        活动
        下载
        论坛
        云栖大会
        公众号
        专家
        专题
        商城
        云大学
        APP
        |

        云头条
        大数据
        阿里开源
        云生态

[TB1DQZsbBU]
[TB1n1OeRFX]

  • 阿里云头条
  • 博客
  • 问答
  • 聚能聊
  • 直播
  • 下载
  • 论坛
  • 云栖大会

登录社区注册账号

【阿里在线技术峰会】蒋晓伟：Blink计算引擎

 1. 云栖社区>
 2. 博客列表>
 3. 正文

[img_c06c5d]

【阿里在线技术峰会】蒋晓伟：Blink计算引擎

云栖小秘书 2016-07-19 21:50:30 浏览11566 评论3

  • 流处理
  • 批处理
  • 首届阿里巴巴在线技术峰会
  • Blink计算引擎
  • 蒋晓伟

摘要：在首届阿里巴巴在线峰会上，阿里资深搜索专家蒋晓伟为大家带来了题为《Blink计
算引擎》的分享，相比于Flink，在上层，Blink具有批和流一体化的完备Table API，使得
其能够支撑各类业务需求；在底层，Blink重新开发了兼容Flink以及生态的Runtime，实现
了流处理和批处理完美的统一。

本文根据阿里资深搜索专家蒋晓伟在首届阿里巴巴在线峰会上的分享整理而成。 此次分享
的重点是Blink计算引擎，它是阿里巴巴搜索的流计算和批处理引擎。相比于Flink，在上
层，Blink具有批和流一体化的完备Table API，使得其能够支撑各类业务需求；在底层，
Blink重新开发了兼容Flink以及生态的Runtime，实现了流处理和批处理完美的统一。


直播视频：


7dee38c6bee3c76d84e6ce6acbf9b9a1e951227b

（点击图片查看视频）


幻灯片下载：点此进入

以下为整理内容。

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

搜索文档的创建和更新

                   90fcaad17cccbeccca8025dd54d5b8b69538bc0b

要建立一个搜索系统，首先需要创建搜索文档，具体的创建过程分为三个步骤：第一步，
将分散在各地的数据同步到HBase上，数据同步之后，HBase中就包含了创建文档所需的全
部数据；第二步，将HBase中的数据进行汇总，经过业务逻辑的处理后，将产生的需要搜索
的文档存在结果表当中；第三步，将HBase中的结果表导出到搜索引擎中，即完成了搜索文
档的创建。值得注意的是：上述每一步骤都包括全量和增量两个流程。

物化视图

                   ecd9b5d076a2be55edf9ab1cc46d3163a3927c2d

结果表可以当做是物化视图，物化视图是一种延伸数据，类似于索引。数据库可以确保物
化视图和其对应的表的一致性。从物化视图的观点出发，可以对全量和增量进行重新解释
，所谓的全量，是相当于索引的创建和重建的流程；而增量则意味着索引的维护。通过物
化视图，仅使用同一句SQL语句即可同时解决增量和全量的问题。

流和表的对偶性

                   25c34be97d162942c817a61feaebf3cb848d7b67

要在大数据内实现增量和全量的统一处理，首先我们需要了解几个概念。

第一个概念是流和表的对偶性。上图的左半部分是一个流，它包括word和 count两列，记
载了每一词的出现次数；右边是一张历史表，同样包含word和count两列，但是word列是具
有对应主键的。如果利用左边的流更新右边的历史表，就会由原来的五条记录缩减到三条
记录。通过物化操作，可以把一个流转化为历史表；当历史表存在时，我们可以通过查看
、导出历史表的修改日志，恢复原来的流。在某种意义上，流和历史表所包含的信息量是
相同的。流和表的对偶性，意味着我们可以将流计算和批处理结合起来。有一点需要注意
的是，这里表是指动态的表，里面的内容是不断修改的。

第二个概念是流的等价性，两个流当且仅当它们产生相同的正则历史表时，两个流等价。
如果有两个流用来更新同一个历史表，假设在不同的时间点，它们都能得到相同的历史表
，则这两个流就是等价的。流的等价性给流处理带来了很大的灵活性，正是这种灵活性使
得我们可以在Blink中完美地结合流处理和批处理。


什么是Blink？

                   13c1cc3cda01eefe7d80fa5e8d0ce1d206f68dfd

Blink是阿里巴巴搜索团队基于Flink开发的计算引擎，其目的是为了支撑阿里巴巴大规模
的计算需求。Blink实现了流处理和批处理完美的统一。相比于Flink，在上层，Blink具有
批和流一体化的完备Table API，使得其能够支撑各类业务需求；在底层，Blink重新开发
了兼容Flink以及生态的Runtime。

Blink的Table API

                   d6326f8b986b6eb84b504031203508fb5ef26cb6

Blink的Table API的设计原则是实现流和批的一体化处理。秉着该原则，Blink开发了一系
列的功能，包括：

  • UDF/UDTF/UDAGG，用户可以利用这些函数轻松实现业务逻辑的表达；
  • 双流Join；
  • Aggregation（min、max、avg、sum、count、distinct_count）；
  • Windowing；
  • Retraction撤回机制。

Blink的Runtime

                   841f6d135a6e92eafbef81ac08c68cbd73922406

Blink在Runtime上也做了很多改进。首先Blink实现与YARN的原生态整合；其次对
Checkpoint和状态管理进行了优化，使其能够真正用于生产环境中；同时，Blink在容错性
、高可用性、稳定性和可运维性等方面都有很大的改进；此外，Blink还支持动态伸缩。


Flink On YARN

                                        

                   110b1bde794673977a92acbb84cc15fdfd1b497b

上图展示的是Flink在YARN上的架构，YARN是Hadoop内的调度系统。Flink与YARN整合的思
路十分简单：在运行Flink之前，首先需要启动Flink集群，该集群需要实现配置好；集群
启用之后，Flink集群就可以接收用户提交的工作；Flink集群接收到用户提供的工作之后
，通过JobManger将从YARN处获取的资源分配给不同的Job。在每个YARN Node上存在一个
YARN NodeManager，它用来调用不同的Container。该架构存在几个明显缺陷：第一，不同
的Flink Job的任务可能会运行在同一Flink TaskManager中，即不同Job的任务可能运行在
同一个进程内，其中一个Job的任务失败可能会杀死整个进程，隔离性较差；第二点，由于
Flink集群需要事先配置，一旦资源被Flink占用后，YARN就无法再将这些资源分配给其他
的集群，这样就有可能导致一定程度的资源浪费，同时如果事先配置的资源不足，Flink集
群是无法简单地扩容；第三点，由于管理全部Job的Flink JobManager进程运行在一个独立
的container，当Job急剧增加时，Flink JobManager就成了整个架构可伸缩性的瓶颈。

Blink YARN的原生态整合

                   ef3c4805aa4fb83bef80419d29030cb6cdb37e84

在Blink YARN的原生态整合中，去掉了单点的JobManager。当用户提交Job时，YARN
ResourceManager会启用一个Job Master，两者一一对应，当Job内的Task需要资源时，再
通过Job Master向YARN申请资源，实现资源的动态分配；同时，不同的Job处于不同的
Container中，确保Job之间的隔离。

Blink的失败处理机制

                   b82d45e1925a0057c9bdec0e23aca06ea1bcdce6

在分布式系统中，失败是不可避免的。面对机器挂掉、进程崩溃时，如何保证系统的一致
性是一个很大的挑战。一致性主要包括至少一次和恰好一次两个语义。至少一次是说，流
来的每个消息能够保证至少处理一次，不会丢失消息。至少一次相对而言比较容易实现，
只需要记录哪些消息成功处理过了，即使某个消息处理失败，也只需要从最后一条成功处
理的消息之后重新开始处理即可。

恰好一次是指处理过的消息与状态的一致性。如何实现恰好一次这种逻辑呢？在分布式系
统中，我们可以通过Chandy-Lamport算法实现恰好一次的逻辑。在流的源头上，当需要做
Checkpoint时，插入名为Barrier的特别消息即可。它的作用是将state 获取快照之前的消
息和之后的消息区分开来。Barrier同其他消息一样，同样会流入每一个operator中。

Blink Worker的错误恢复

                   5d30764265e6b37525f6128412495b981f73db4f

Blink Worker的错误恢复分为两种情形：第一种是At Least Once，如果一个节点Fail了，
我们只需要重启该节点，然后找到影响该节点的源头，再将源头进行回放即可，无需重启
整个Job；第二种是Exactly Once，如果有一个节点Fail，我们需要找到该节点的连通图，
将该节点重启，然后将连通图回退到上次checkpoint的位置进行回放即可。

Blink Master的高可用性

                   c2e0a70c157f59dbb20178b7e2f44bf7f1129d3d

当Blink的JobMaster失败之后，YARN会重新启动该JobMaster，但是此时JobMaster已经丢
失了原来的状态。为了保证JobMaster不丢失原来的状态，我们将JobMaster内的代码写成
了状态机，每次状态修改之前都需要Log到HDFS；在新的JobMaster启动之前，通过HDFS的
回放得到其原有状态，从而保障了Blink Master的高可用性。

Blink的动态伸缩

                   922c7a92a9f8fdb8ae5adcf2283eccc48c6ae382

在流计算中，实验和真正上线使用时是存在偏差的，而且随着业务的增加，流量也会随之
改变。通过引入bucket，动态支持Blink的伸缩。此外，在Blink中，我们添加了多个监控
指标，用于观测Job性能。


现状与计划

                   9c3af79cb71c226fea53dd1d9c1597d27f60744e

目前Blink在阿里已经实现上千台机器规模的集群上线，用于支撑搜索和推荐的核心业务。
同时，集团内外对Blink表现出了浓厚的兴趣，包括Uber、FaceBook等在内的企业都在考虑
使用Blink。

版权声明：本文内容由互联网用户自发贡献，版权归作者所有，本社区不拥有所有权，也
不承担相关法律责任。如果您发现本社区中有涉嫌抄袭的内容，欢迎发送邮件至：
yqgroup@service.aliyun.com 进行举报，并提供相关证据，一经查实，本社区将立刻删除
涉嫌侵权内容。
[TB1lKbLGb9]

用云栖社区APP，舒服~

【云栖快讯】诚邀你用自己的技术能力来用心回答每一个问题，通过回答传承技术知识、
经验、心得，问答专家期待你加入！  详情请点击
评论 (3) 点赞 (8) 收藏 (13)

分享到:
     
    [qrcode]

  • 上一篇：资料来啦（含视频+PDF）！首届阿里巴巴在线技术峰会，9位大V演讲整理！
  • 下一篇：【阿里在线技术峰会】易立：从Docker到容器服务 ——Docker 云端实践之路

相关文章

  • 阿里蒋晓伟谈流计算和批处理引擎Blink，以及Flink…
  • 资料来啦（含视频+PDF）！首届阿里巴巴在线技术峰会，9…
  • 蚂蚁金服&阿里云在线金融技术峰会全套资料（视频+PDF）…
  • 大V云集！参加首届阿里巴巴在线技术峰会的八大理由
  • 首次加入云栖大会的Flink专场，究竟都讲了啥？
  • 双11享Go了吗？2017阿里双11在线峰会续写科技盛宴…
  • 双11享Go了吗？2017阿里双11在线峰会续写科技盛宴…
  • Apache Flink改进及其在阿里巴巴搜索中的应用
  • 阿里技术高P访谈之“呆萌”程序员蒋晓伟为何从Facebo…
  • 不止于流，615杭州流计算峰会圆满举行

网友评论

[avat] 1F
超级大富豪  2016-07-22 11:42:44

不错

(来自社区APP)
0 0
[                    ]
取消评论
[avat] 2F
梦总要实现  2016-07-26 09:48:15

既实现了业务又拓展了架构，这是理想的研发工作。
谢谢分享！

0 0
[                    ]
取消评论
[avat] 3F
文溪  2016-09-08 20:38:35

多点干货啊，有用Blink做推荐没

0 1
[img_]
祎休 2017-10-20 14:20:58

集团内就是用Blink做推荐和搜索的

0
[@祎休               ]
取消评论
[                    ]
取消评论
登录后可评论，请登录或注册
评论
  • 达人介绍

[img_7ebdbc]
    云栖小秘书
    文章244篇 | 关注463
    关注

  • 目录

  • 文中提到的云产品

● 阿里云办公
一站式提供企业即时通讯、销售管理、协同办公。查看详情
● 开放搜索
是解决用户结构化数据搜索需求的托管服务，支持数据结构、搜索排序、数据处理自由定
制。为您的网... 查看详情
● 阿里绿网
基于深度学习技术及阿里巴巴多年的海量数据支撑，提供多样化的内容识别服务，能有效
帮助用户降低... 查看详情
● 云服务器ECS
为您提供简单高效、处理能力可弹性伸缩的计算服务，帮助您快速构建更稳定、安全的应
用，提升运维效... 查看详情

  • 博主其他文章更多>

  • 云栖社区版权提示与说明【2018版】
  • 【直播回顾&资料下载】2017阿里巴巴双11技术十二讲，历数双11精彩技术干货
  • 【信息图表】从拥抱到开源，阿里开源贡献一览
  • 《科技之巅2》序——机器智能数据智能：工具之王
  • 《科技之巅》序 ——科技引爆未来
  • 如何打造支撑百万用户的分布式代码托管平台
  • 云上DevOps开发布局
  • 云上Docker的Spring Cloud微服务应用实践分享
  • 云数据库Redis版的开源之路
  • 新零售时代的创新

  • 相关话题更多>

  • 聊聊双11背后的黑科技（12月13日直播）
  • 聊聊双11背后的黑科技（12月14日直播）
  • 【阿里云新品发布】从拥抱到超越，看阿里云消息队列Kafka如何实现8个9的数据可靠
    性
  • 【阿里云新品发布】不高清，看个球？EGS（弹性GPU服务）助力世界杯高清直播。
  • 如果技术是上帝的笑...，那么干代码的你属于哪种思维模式呢？

阿里云总监课正式启航

阿里云总监课正式启航

热点导航
    闲时流量包云计算网络安全互联网架构 ECS升级配置物联网教程 PHP

用户关注
    自动化测试解决方案 linux命令云服务 JavaScript 函数服务器监控 Python语言移动
    数据分析

更多推荐
    用户体验云数据库Rds 负载均衡域名注册 Whois查询数据可视化 ICP备案查询主题地
    图阿里云大学 cn域名 Js Mysql 移动站 IT论坛企业邮箱签名文件

